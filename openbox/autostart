#!/bin/sh

_vnc() {

    echo "Started VNC"

    # daemons
    xsettingsd -c "${HOME}/arch/xfce4-terminal/xsettingsd" &

    # bacgkround
    xsetroot -solid '#008080'

    # interface
    tint2 -c "${HOME}/arch/tint2/tint2rc-vnc" &
}

_desktop() {

    echo "Started Openbox"
    
    # mouse sens
    xinput set-prop 11 326 0.5
    
    # alsa
    "${HOME}/arch/scripts/sound.sh" pch

    # daemons
    xsettingsd -c "${HOME}/arch/xfce4-terminal/xsettingsd" &
    xcompmgr -a &

    # resolution and background
    "${HOME}/arch/scripts/fixres.sh"
    feh --no-fehbg --bg-scale "${HOME}/arch/wall/default.jpg"

    # conky kernel
    conky -d -c "${HOME}/arch/conky/conkyrc-kernel" --xinerama-head 0
    conky -d -c "${HOME}/arch/conky/conkyrc-kernel" --xinerama-head 1
    conky -d -c "${HOME}/arch/conky/conkyrc-kernel" --xinerama-head 2

    # conky tint2
    mkfifo /tmp/conky-tint2.fifo
    conky -d -c "${HOME}/arch/conky/conkyrc-tint2"

    # tray
    tint2 -c "${HOME}/arch/tint2/tint2rc-top" &
    tint2 -c "${HOME}/arch/tint2/tint2rc-bottom" &

    # other
    sleep 1
    "${HOME}/arch/scripts/clip.sh" > "${HOME}/clip.log" 2>&1 &
    sleep 1
    flameshot &
    sleep 1
    #synergy &

    # autolock
    #xautolock -time 60 -locker "systemctl suspend" -detectsleep &

    xset -display :0.0 dpms 0 0 0
    nvidia-settings -a [gpu:0]/GpuPowerMizerMode=1
}

/usr/bin/xdpyinfo | grep VNC > /dev/null
_is_vnc="$?" # 0 if vnc

[ ${_is_vnc} -eq 0 ] || _desktop
[ ${_is_vnc} -eq 0 ] && _vnc
