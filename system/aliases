#!/bin/bash
# shellcheck disable=SC2181

alias ls='LC_COLLATE=C ls -A -o -h --color=always --group-directories-first'

alias chx='chmod +x'
alias permof='stat --printf "%n - %a\n"'
alias sizeof='du -sh'
alias grep='grep --color'
#alias df='df -h -T --total'
alias c='clear'
alias x='exit'

alias sr='screen -r'
alias sn='screen -S'

alias startx='exec startx -- -logverbose 0'

mkmine() {
    if [[ -n "${1}" ]]
    then
        sudo chown -R "${USER}:${USER}" "${1}"
    else
        echo "No file defined."
    fi
}

gitpush() {
    git add .
    git commit -m "a"
    git push
}

gitreset() {
    git fetch origin
    git reset --hard origin/master
}

work() {
    local -a array=()
    mapfile -t array < <( jq -crM '.work | "/d:" + .domain, "/v:" + .host, "/u:" + .user, "/p:" + .password' "${HOME}/arch/secret.json" )
    echo "Connecting to: ${array[0]} ${array[1]} ${array[2]}"
    xfreerdp /cert-ignore /bpp:32 /network:lan /audio-mode:2 /multimon /floatbar:sticky:off /gfx:RFX -themes -wallpaper "${array[@]}"
    echo "Disconnected"
}

rsnc() {
    sudo pacman -Rsnc "$@"
    echo -e "\033[32mUpdating db...\033[0m"
    sudo updatedb
    echo -e "\033[31mCheck for remaining files in ${HOME}\033[0m"
}

m4atomp3() {
    for i in "${@}"
    do
        echo "-> Converting ${i}"
        ffmpeg -i "${i}" -c:v copy -c:a libmp3lame -q:a 2 "${i}.mp3"
    done
}

fixntp() {
    sudo rc stop ntpd
    sudo ntpd -gq
    sudo rc start ntpd
}

ytdl() {
    youtube-dl -f 'bestaudio[ext=m4a]' "${1}"
}

todo() {
    if [ "${1}" = "off" ] || [ -z "${1}" ]
    then
        if [ -z "${1}" ]
        then
            qtextpad "${HOME}/.todo" 
        fi
        local -r pid="$(pgrep -f conkyrc-todo)"
        if [ -n "${pid}" ]
        then
            echo "Killing existing conky instance (${pid})"
            /usr/bin/kill --verbose --signal TERM --timeout 10000 KILL "${pid}"
        fi
        if [ -z "${1}" ]
        then
            conky -d -c "${HOME}/arch/conky/conkyrc-todo" --xinerama-head 0 > /dev/null 2>&1
        fi
    else
        echo "invalid parameter"
    fi
}

alias speedtest='wget http://mirror.carnet.hr/debian-cd/7.8.0/amd64/iso-cd/debian-7.8.0-amd64-netinst.iso -O /dev/null'
alias syu='sudo pacman -Syu'
alias aur='auracle outdated'
alias fixres='/home/igor/arch/scripts/fixres.sh'
alias snd='/home/igor/arch/scripts/sound.sh'
alias mountdisk="sudo mount -t ext4 -U 23147c37-efb6-4837-83aa-87808c70b87a /home/igor/_disk/"
alias mountmmc="sudo mount -U ce63484b-3828-4024-9f9c-c120f43ca4ec /home/igor/_mmc/"
alias ddiff="code -d"
alias wget="wget --no-hsts"
alias md2pdf='markdown-pdf'
alias rezije='node /home/igor/git/rezije/main.js'

mountlinode() {
    local -r public="/home/igor/_public/"
    local -r private="/home/igor/_private/"
    mkdir -p "${public}"
    mkdir -p "${private}"
    local -r username="$(jq -crM '.linode.samba.username' "${HOME}/arch/secret.json")"
    local -r password="$(jq -crM '.linode.samba.password' "${HOME}/arch/secret.json")"
    sudo mount -t cifs -o username="${username}",password="${password}",uid="$(id -u)",gid="$(id -g)" //avacyn.aerium.hr/public "${public}"
    sudo mount -t cifs -o username="${username}",password="${password}",uid="$(id -u)",gid="$(id -g)" //avacyn.aerium.hr/private "${private}"
}

alias zxvf="tar zxvf"
alias sudo='sudo -E'
alias unmountall='/home/igor/arch/qtfm/qtfm.sh unmount'

alias vmwareload="sudo modprobe -a vmw_vmci vmmon"
alias vboxload="sudo modprobe -a vboxdrv vboxnetadp vboxnetflt"
alias watchincrease='sudo sysctl fs.inotify.max_user_watches=524288'

# exports
export QT_QPA_PLATFORMTHEME="qt5ct"
export QT_AUTO_SCREEN_SCALE_FACTOR=0
export NO_AT_BRIDGE=1
export XDG_RUNTIME_DIR="/tmp/runtime-igor"
export EDITOR=nano
export DOTNET_CLI_TELEMETRY_OPTOUT=true
export LESSHISTFILE=/dev/null

# shellcheck disable=SC1091
source /usr/share/git/completion/git-prompt.sh

bold=$(tput bold)
green=$(tput setaf 2)
gray=$(tput setaf 7)
reset=$(tput sgr0)
PS1='\w $(__git_ps1 "\[$gray\](%s)\[$reset\] ")\[$green\]\[$bold\]>>\[$reset\] '

